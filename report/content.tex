\section{The Lean theorem prover}
\label{sec:lean-intro}

{\color{green} Here a quick intro to lean so that the reader can understand what is going on : \\
- Global presentation of Lean (introductory §)\\
- A few elements of type theory \\
- A bit of syntax (maybe explanation of the lattice structure of 'Subgroup G'\\ }

This section is an introduction the Lean theorem prover, its aim is to give to the readers unfamiliar with \Lean the minimal amount of knowledge necessary to understand this report. More are available at \ref{sec:ComplementLean} and even more can be found in \todo{add real referneces}.

\subsection{General introduction to \Lean}%
\label{sub:Introduction to type theory}
- generic type
- function
- defs
- proofs
    - symbols
    - thm
- instances

   
    As such every \Lean  expression has an associated type, and we will denote as \lean{expr : t} the fact that the expression \lean{expr} has type \lean{t}. For instance :
\begin{itemize} 
    \item \lean{4 : ℕ}
    \item \lean{true : Bool} 
    \item \lean{∃ n : ℕ, 3 ≤ n : Prop}.
\end{itemize}
\todo{change linescape}
A function from a type \lean{α} to a type \lean{β} is an element of type \lean{α → β}


    
\subsection{Formalization of the notion of subgroup}%
\label{sub:Formalization of the notion of subgroup}

\section{Groups of Lie type}
{\color{green} There all the material about fsg + Groups of Lie Type (probably all math and (almost) no lean: \\
- A few definitions (the classification, a simple group etc.)(I'll probably add the definitions of a simple group in annex, just to be sure)\\
- Coxeter groups + implementation in lean \\
- The notion of a $BN-$pair + lean //}


As said in the introduction, the main obstacle one may encounter working  with groups of Lie type is the lack of formal consensual definition. The best way to describe these groups would be to say that they are groups which "look like Lie groups" but are not necessarily \todo{see if at all} . For instance, the general and special linear groups, as well as the orthogonal and symplectic groups over finite fields are all groups of Lie type \todo{are they Lie ?}.  


If this lack of definition does not happen to be a real issue when doing normal pen-and-paper mathematics \todo{Carter}, it becomes more of a problem when it comes to formalization. Fortunately, the theory of groups of Lie type provides us with a powerful tool $BN$-\emph{pairs}. A $BN$-pair over a group $G$ is pair of subgroups of $G$ verifying certain conditions and can be used to state very important results about the structure of the group $G$. Moreover, \emph{every finite group of Lie type} is endowed with such structure and as our work mainly aims at formalizing the \CFSG, this notion makes for an almost perfect foundation for the formalization of groups of Lie type. 
    However, working $BN$-pairs in \Lean is not exactly the best solution as it relies heavily on the theory of quotient groups, which is formalized in the Mathlib library of \Lean but is not the most pleasant to work with. \todo{say why ?} That is why we introduced an equivalent by more formalization-friendly notion called a $BN\pi$-triplet which is based on surjection instead of quotient, which is the one we will use throughout this report.

The goal of this section is to define $BN$-pairs and present some results about the notion of \emph{double cosets}, a basic concept of groups theory bearing strong links with groups of Lie type. This section starts by defining double cosets, $BN$-pairs and $BN\pi$-triplets and present their formalization in . Then, in \ref{sub:Double Cosets} some results about double cosets and especially doubles cosets of groups with $BN\pi$-tripleti. Finally, these results are put to good use in \ref{sub:GL} to build a $BN\pi$-triplet over the general linear group over a field.

\subsection{Definition}%

\label{sub:Definition}

For this all, report we we fix two groups $G$ and $W$ and in \Lean we declare two variables \lean{G W: Type*} endowed with a \lean{[Group G]} and \lean{[Group W]} instance, respectively. We additionally fix two subgroups $B$ and $N$ of $G$ and $\pi$ a group homomorphism from $N$ to $W$.

First and foremost, we need to define the notion of double coset. A concept that although elementary is of capital importance to discuss effectively the structure of groups of Lie type.We only give their definition this subsection and there will be further discussion on this notion and its link with \ref{sub:Double Cosets}.

\begin{definition}[Double coset] \label{def:DC}
    A \emph{double coset} of a subgroup $H$ of $G$ is a set of the form $HgH$ for $g \in G$. We  will denote as $C\left( g \right)$ the double coset $BgB$, for $w \in G$. \end{definition} 

    Double cosets are defined in \lean{DoubleCoset.lean} file of the project as
    \begin{leancode}
abbrev DoubleCoset (B : Subgroup G) (w : G) : Set G := 
    {x | ∃ b  b' : B, b * w * b' = x}
    \end{leancode} 
    However, for the sake of readability the notation below was added to code \footnote{The code presented here allows to write \lean{C} instead \lean{DoubleCoset} in the code.} :
\begin{leancode}
notation "C"  => DoubleCoset 
\end{leancode}

The definition of double coset allow us to introduce the main object of study of this report : $BN$-pairs.
\todo{citer carter} 
\begin{definition}[$BN$-pair] \label{BN}
    The couple $\left( B,N \right)$ of subgroups of $G$ forms a \emph{$BN$-pair} over $G$ if it that satisfies the following axioms :
    \begin{enumerate}
        \item $G$ is generated by $B$ and $N$.
        \item the subgroup $T := B \cap N$ is normal in $N$.
        \item The group $N / T$ is generated by a set $S$ of elements of order 2.
        \item For all $n_{i} \in N$ that maps to an element of $S$ under the natural group homomorphism $N \to N / T$, $n_{i}Bni \neq B$.
        \item For all $n_{i}$ as above and all $n \in N, \ $ $n_i B n \subset C(n_in) \cup C(n)$
    \end{enumerate} where $C(g)$ is the double coset $BgB$ for all $g \in G$.
\end{definition}


\begin{notation}
    If $\left( B,N \right)$ is a $BN-$pair over $G$, we also say that $\left( G, B, N, S \right)$ is a \emph{Tits system}, see for instance \cite{bourbaki_groupes_2007}.
\end{notation}


However, the definition of a $BN$-pair presented above can be impractical manipulate in \Lean. Indeed, if the quotient groups are fully implemented in the Mathlib library and working with this definition would still be be possible, it is simpler to avoid their use and instead have recourse to surjective group homomorphism. 
    This is why we introduced the new and equivalent (see \ref{thm:to pi or not to pi}) structure of a $BN\pi-$triplet.  %We will nonetheless need to use quotient groups later in this work \todo{réf}.

\begin{definition}[$BN\pi$-Triplet] \label{BNpi}
  The triplet $\left( B,N, \pi \right)$ is a \emph{$BN\pi$-Triplet} over the $G$ if it satisfies the following axioms :
    \begin{enumerate}
        \item $G$ is generated by $B$ and $N$.
        \item the subgroup $T := B \cap N$ is the kernel of $\pi$.
        \item $\pi$ is surjective
        \item The group $W$ is generated by a set $S$ of elements of order 2.
        \item For all $n_{i} \in N$ that maps to an element of $S$ through $\pi$, $n_{i}Bni \neq B$.
        \item For all $n_{i}$ as above and all $n \in N, \ $ $n_i B n \subset C(n_in) \cup C(n)$
    \end{enumerate}
\end{definition}


First of all let us show that the two structures are equivalent. This is the point of the following theorem :

\begin{theoreme} \label{thm:to pi or not to pi}
    The group $G$ is endowed with a $BN$-pair structure if and only if it is endowed with a $BN\pi$-structure.
\end{theoreme}

\begin{proof}
    If $G$ is endowed with a $BN$-pair structure, it immediately has a $BN\pi$-Triplet with $W = N / (B \cap N)$ and $\pi$ the natural projection $N \to W$.

    Conversely, if $G$ has a $BN\pi$-Triplet structure, then by lifting $\pi$ through the natural projection to $N / \left( B \cap N \right)$ we obtain a group isomorphism $\tilde{\pi} : W \MapsTo N / \left( B \cap N \right)$. Then if $S \subset W$ denotes the generating set of $W$ from the definition of a $BN\pi$-triplet, $\left(G, B, N, \tilde{\pi}^{-1}\left( S \right)  \right)$ is a Tits system.
\end{proof}

The concept of $BN\pi$-triplet is formalized as follow in the \lean{Basic.lean} file :

\begin{implementation}[$BN\pi$-Triplet] \

\begin{leancode}
structure BNpiTriplet (G : Type*) [Group G] (W : Type*) [Group W] where
  B : Subgroup G

  N : Subgroup G
  
  S : Set W

  pi : N →* W

  BN_gen_Group : ⊤ = B ⊔ N

  pi_surj : Function.Surjective pi

  ker_pi_eq_B_subgroupOf_N : pi.ker = B.subgroupOf N

  S_auto_inverse : ∀ s ∈ S, s * s = 1

  top_eq_S_closure : ⊤ = closure S

  left_right_mul_B_neq_B_of_map_S: ∀ ni ∈ pi⁻¹' S,
    ¬ {(ni :G) * (b : G) * ni | b : B} ⊆  B

  subset_union_doubleCosets :  ∀ (n ni : N), ni ∈ pi ⁻¹' S ->
   {ni * b.val * n | b : B} ⊆ C B (ni * n) ∪ C B n
\end{leancode}
\end{implementation}

\begin{remarque}
    \begin{enumerate}
        \item The term \lean{B.subgroupOf N : Subgroup N} designates the groups \lean{B ⊓ N} seen as a subgroup of \lean{N} instead of \lean{G}.
        \item The property \lean{S_auto_inverse : ∀ s ∈ S, s * s = 1} ensure that every element of \lean{S : Set W} has order at most \lean{2}, and property  \lean{left_right_mul_B_neq_B_of_map_S} ensures that they do not have order \lean{1}.
    \end{enumerate}
    
\end{remarque}

\subsection{Double Cosets}
\label{sub:Double Cosets}

In this section we expose some properties on the double cosets and especially double cosets of groups with a $BN$-pair.

We do not suppose at first that there is a $BN\pi$-triplet over $G$ and state some general facts about double cosets : 

\begin{proprietes} \label{prop:DC1}
    We have the following properties :
    \begin{itemize}
        \item  $C\left( 1 \right) = B$
        \item $\forall g,g'\in G,C\left( g g' \right) \subset C(g) C(g')$
        \item $\forall g \in G, C\left( g^{-1} \right) = C\left( g \right)^{-1}$.
        \item Two double cosets are either equal or disjoints.
    \end{itemize}
\end{proprietes}

\begin{proof}
    The first three points are immediate. 

    Let $g_1, g_2$ be two elements of $G$ such that $C\left( g_1 \right) \cap C\left( g_2 \right) \neq \emptyset$. There exists $b_1, b_2, b'_1, b'_2 \in B$ such that $b_1 g_1 b_1' = b_2 g_2 b'_2 $. Hence, $g = b_1^{-1} b_2 g_2 b_2' b_1'^{-1} \in  C\left( g_2 \right) $ and $C(g_1) = Bg_1B\subset C(g_2)$. By symmetry, we have $C\left( g_1 \right) = C\left( g_2 \right)$, and hence the fourth point.
\end{proof} 

These properties can be found in the \lean{DoubleCoset.lean} file as :
\begin{leancode}
variable {B : Subgroup G}

theorem doubleCoset_one : DoubleCoset B 1 = B.carrier

theorem DoubleCoset.mul_le_mul (g g': G) : C B (g*g') ⊆ C B g * C B g

theorem DoubleCoset.inv (g : G) : (C B g)⁻¹ = C B g⁻¹

theorem DoubleCoset.disjoint_of_neq (g g' :G) (h : C B g ≠ C B g') : 
  Disjoint (C B g) (C B g') 
\end{leancode}

This file also contains some results deriving from the ones above. They have little mathematical interest but make working with double cosets in \Lean more convenient. Some of them can be found below.

\begin{leancode}
lemma DoubleCoset.eq_doubleProd_singleton (g :G) : C B g = B.carrier * {g} * B.carrier

theorem DoubleCoset.self_mem {g : G} : g ∈ C B g

theorem DoubleCoset.eq_of_gen_mem {g g' :G} (h : g ∈ C B g') : C B g = C B g'

theorem DoubleCoset.mul_apply (g g' :G) :
  (C B g) * (C B g') = {x :G| ∃ b1 : B,∃ b2 : B, ∃ b3 : B, b1 * g * b2 * g' * b3 =x}
\end{leancode}

Moreover the link between double cosets and $BN\pi$-triplet appears more clearly through the following properties: 

\begin{proprietes} \label{prop:DC2}
    \begin{enumerate}
\item For all $g,g' \in G$, we have  $g B g' \subset C(g) \cup C(g'g) $ if and only if $C(g). C(g') \subset C(g) \cup  C(g')$
\item For all $g_i, g$ such that $C(g_i).C(g) \subset C(g) \cup C(g_i g)$
     \[
     C(g_i) C(g) = \begin{cases}
         C(g_ig) \text{ if } C(g) \not \subset C(g_i).C(g)\\
         C(g) \cup C(g_ig) \text{ otherwise}
     \end{cases}
     .\] 
 \item If $g_{i} \in G$ verifies, $g_{i}^2 = 1$,  $g_{i} B g_{i} \subset B \cup C(g_{i})$ and $g_{i} B g_{i} \not\subset B$ then $B \cup C(g_{i})$  is equal to $C(g_i) C(g_i)$ and is a subgroup of $G$.
    \end{enumerate}
\end{proprietes}

\begin{proof}
The first point is immediate, the second comes from the hypothesis and the points 2 and 4 of \ref{prop:DC1}. For the third point, the identity $B \cup C(g_{i}) = C(g_i). C\left( g_i \right)$  follows from the second point in the case $g = g_i$ and $g_i ^2 = 1$, and using this equality it is easy to show that $B \cup C(g_i)$ is a subgroup of $G$.
\end{proof} 

The point 1 of \ref{prop:DC2} can be use to give an alternative statement to point 5 and 6 of \ref{BN} or \ref{BNpi}. The point $6$ can be seen as a very particular case of \todo{yes} and will be used in \ref{sub:GL}. We formalized it as :
\begin{leancode}
def B_union_C_of_simple {s : G} (hs : s*s = 1) (h: {s*b*s | b : B} ⊆ C B s ∪ (C B (s*s)))
    (h' :¬ {s*b*s | b:B} ⊆ B.carrier) : Subgroup G where
  carrier := B.carrier ∪ (C B s)
  ...
\end{leancode}

We now suppose that $\left( B,N, \pi \right)$ is a $BN\pi$-triplet over $G$. In \Lean we fix a variable \lean{TS} of type \lean{BNpiTriplet G W}. 

\begin{definition}[LE NAAAAAAAME] \label{def:BNDC}
The \emph{double coset} $C'(w)$ of an element $w\in W$ is defined as the double coset $C(n)$ of $B$ for $n \in N$ mapping to $w$ through $\pi$.
\end{definition}

\begin{remark}
    \begin{itemize}
        \item The set $C'\left( w \right)$ is well defined for all $w \in W$ because using the point 4 of \ref{BNpi} we have $\ker \pi = N \cap B \le B$.
        \item Some authors use the above definition of a double coset to define $BN\pi$-pairs (see for example \cite{bourbaki_groupes_2007}) as the most important results of the theory of groups with $BN$-pair are more conveniently expressed through double cosets of elements $W$ than double cosets of elements of $G$. The theorems \todo{} below are good examples of this. 
However, it is more comfortable to use the definition \ref{def:BNDC} to formalize the property of a certain group having a $BN\pi$-triplet and to first prove properties of double cosets of elements of $G$ and then transfer them to double cosets of elements of $W$.
\end{itemize}
\end{remark}

In order to make the \Lean code more readable, we encoded the definition \lean{def BNpiTriplet.C (n : TS.N) : Set G := C TS.B n} that allows to access to \lean{C TS.B n : Set G} by typing \lean{TS.C n : Set G} for any element \lean{n : TS.N}. Then we formalize the above definition as :
\begin{leancode}
def BNpiTriplet.C' (w : W): Set G := 
  TS.C (@Classical.choose TS.N (fun n => TS.pi n = w) (TS.pi_surj w))
\end{leancode} 

\begin{commentary} 
The function \lean{Classical.choose : {α : Type *} {p : α → Prop} (h : ∃ x, p x) : α} maps to an object \lean{h : ∃ x, p x} for a certain \lean{p : α → Prop} a element of type \lean{α} that verifies \lean{p}
\end{commentary}

For a convenient use of the double cosets of elements of $W$, we added the following lemmas :

\begin{leancode}
lemma C'_comm_pi (n : TS.N) : TS.C' (TS.pi n) = TS.C n 

lemma C'apply (w : W) : ∃ n ∈ TS.N, TS.C' w = C TS.B n 

lemma C'apply' (w : W) : ∃ n : TS.N, w = TS.pi n ∧ TS.C' w = C TS.B n
\end{leancode}

Most of the properties of double cosets of elements of $G$ can be transferred over double cosets of elements of $W$, for instance we have : 

\begin{proprietes} \label{prop:DC3}
    \begin{itemize}
        \item  $C'\left( 1 \right) = B$
        \item $\forall w,w'\in G, C'\left( w w' \right) \subset C(w) C(w')$
        \item $\forall w \in G, C'\left( w^{-1} \right) = C\left( w \right)^{-1}$.
        \item Two double cosets are either equal or disjoints.
\item $\forall s \in S, \forall w \in W, C'(s). C'(w) \subset C'(s) \cup  C'(w')$
\item For all $s \in S$ and $w \in W$ we have :
     \[
     C'(s) C'(w) = \begin{cases}
         C'(sw) \text{ if } C'(s) \not \subset C'(s).C'(w)\\
         C'(w) \cup C'(sw) \text{ otherwise}
     \end{cases}
     .\] 
    \end{itemize}
\end{proprietes} \todo{see wht todo{ (maybe add implementation)} } 

\begin{proof}
    These properties follows from \ref{prop:DC1} and \ref{prop:DC2}.
\end{proof}

We can now use these results to show an important result of the theory of groups with $BN$-pairs : the decomposition. of $G$ in double cosets.

\begin{theoreme}[Double coset decomposition] \label{thm:DCD}
    The group $G$ is equal to $B N B = \bigcup_{w \in W} C'\left( w \right)$.
\end{theoreme}

\begin{proof}
    First, let us show that $BNB$ is a subgroup of $G$. It appears immediately that $1 \in BNB$ and $BNB $ is closed by inversion. To prove that $BWB$ is closed under multiplication we will need to prove the following lemma : 
\begin{lemme} \label{lem:BWB}
    Let $s_1, \ldots,s_q \in S$ and $w \in W$. We have
    \[
        C'\left( s_1,\ldots s_q \right). C'(w) \underset{1\le i_1 < ... < i_p \le q}{\subset \bigcup C' ( s_{i_1}\ldots }\ s_{i_p} w )
    .\] 
\end{lemme} 
\begin{proof}
    We prove it by induction, on $q$, the case $q=0$ being trivial. Suppose $q \ge 1 $ and that the lemma holds for $q -1$. Then, we have :
    \begin{align*}
        C'(s_1,\ldots,s_q). C(w) &\subset C'(s_1).C'(s_2,\ldots,s_q).C'(w) &\text{ by point 2 of \ref{prop:DC3}}\\
                                 &\subset C'(s_1) \bigcup_{2\le i_2 < ... < i_p \le q} C'\left( s_{i_2}\ldots s_{i_p} w \right)& \text{ by induction}\\
                                 & \subset \bigcup_{2\le i_2 < ... < i_p \le q} C'\left( s_{i_2}\ldots s_{i_p} w \right) \cup C'\left( s_1 \right)C'\left( s_{i_2}\ldots s_{i_p} w \right) & \text{ by point 6 of \ref{prop:DC3}}\\
                                 &= \bigcup_{1\le i_1 < ... < i_p \le q} C'\left( s_{i_1}\ldots s_{i_p} w \right)
    .\end{align*}
\end{proof}


Let $x,y \in BNB$. There exists $v,w \in W$ such that $x \in C'(v)$ and $y \in C'(w)$. As the set $S$ generates $W$ we have a finite sequence $s_1,\ldots,s_q$ of elements of $S$ such that $v = s_1 \ldots s_q$ and by the above lemma $xy \in C(v).C(w) \subset \bigcup_{1 \le i_1 < ... < i_p \le q} C(s_1\ldots s_q w) \subset BNB$.

Thus $BNB$ is a subgroup of $G$ that contains both $B$ and $N$, so it is equal to $G$.
\end{proof}

The group $BNB$ appear in the document \lean{basic.lean} as 
\begin{leancode}
def BNB : Subgroup G where
  carrier := TS.B *  TS.N * TS.B
  ...
\end{leancode}

We formalized the theorem \ref{thm:DCD} as well as lemma \ref{lem:BWB} as  following :
\begin{leancode}
theorem doubleCosetDecomp : ⊤ = BNB TS

theorem simple_prodsubset_union_of_simples' (w : W) {ls : List W} 
 (lsinS :∀ s ∈ ls, s ∈ TS.S): 
  TS.C' ls.prod * TS.C' w ⊆ ⋃ l ∈ { l | l.Sublist ls}, TS.C' (l.prod * w)
\end{leancode}

A more convenient version of \ref{thm:DCD} can be found as :
\begin{leancode}
theorem doubleCosetDecomp' (g : G) : ∃ w, g ∈ TS.C' w 
\end{leancode}



\subsection{Example : the general linear group}
\label{sub:GL}
For this section we fix a natural number $n$ and a field $F$.
In a similar fashion, in lean we fix : 
\begin{leancode}
variable {F : Type*} [Field F] [DecidableEq F] 
variable {n : Type*} [Fintype n] [DecidableEq n] 
\end{leancode}

\begin{notation}
    We will denote as $GL_n(F)$ the \emph{general linear groups} \textit{i.e.} the groups of invertible $n \times n$ matrices over the field $F$. In \Lean this groups is denoted \lean{GL n F} and is defined as the group of units of the ring \lean{Matrix n n F} of matrices idexed by the type \lean{n} with coefficients in \lean{F}.
\end{notation} 

The goal of this section is to show that the general linear group $GL_n\left( F \right)$ admits a $BN$-pair by showing that it has a $BN\pi$-triplet structure. In order to do so, we first need to define the notion of monomial matrices.

\begin{definition}[Monomial matrix]
    A \emph{monomial matrix} $M$ is a square matrix with one and only one nonzero coefficient per line and column.
\end{definition}

\begin{propriete} \label{prop:monomial}
    The set of monomial matrices is a subgroup of $GL_n\left( F \right)$ that will be denoted as $N_n(F)$.
\end{propriete}

\begin{proof}
    First, the identity matrix is monomial. Next, let $M = \left( m_{i,j} \right)_{i,j \in \{1,\ldots,n\}}$ and $N =\left( n_{i,j} \right)_{i,j \in \{1,..,n\}}$ be monomial matrices. Let $i \in \{1,..,n\}$ and $k_i$ denote the only nonzero coefficient of the $i-$th line of $M$. Then, $p_{i,j}$the coefficient $(i,j)$ of the matrix $P:= M*N$ is equal to $p_{i,j} = \sum_{k=1}^{n} m_{i,k}n_{k,j} = m_{i,k_i}n_{k_i, j}$ for all $j \in \{1,\ldots,n\}$. Hence, $P$ has only one nonzero coefficient on the $i$-th line : the coefficient on the $j_{k_i}-$th line ; where $j_{k_i}$ is the only nonzero coefficient on the $k_i-$th line of $N$.\\
    Finally, the calculations above show that the matrix $M' = \left( m'_{i,j} \right)_{i,j \in \{1,\ldots,n\}}$ defined by $m'_{i,j} = 1 /{m_{j,i}}$ if $m_{j,i} \neq 0$ and $0$ otherwise is the inverse of $M$ and is monomial.
\end{proof}

\begin{implementation}
    In \Lean the property of being monomial is formalized through
    \begin{leancode}
def Matrix.Monomial (M : Matrix n n F) : Prop := 
    (∀ i, ∃! j, M i j ≠ 0) ∧ ∀ j, ∃! i, M i j ≠ 0
    \end{leancode}
    The groups of monomial matrices is defined as the subgroup of \lean{GL n F} made of the invertible matrices who coerce to monomial matrices.
    \begin{leancode}
def MonomialGroup : Subgroup (GL n F) where
  carrier := {M : GL n F | Monomial M.val}
    ...
\end{leancode}
\end{implementation}

The group $N_n\left( F \right)$ will serve as the $N$ subgroup of the $BN\pi$-triplet over $GL_n(F)$. Now let us define the $B$ subgroup.

\begin{definition}[Triangular group]
    The \emph{(upper) triangular group} $B_n\left( F \right)$ is the subgroup of $GL_n\left( F \right)$ made of the invertible upper triangular matrices.
\end{definition}

\begin{remarque}
Unless explicitly stated otherwise a triangular matrix denotes an \emph{upper} triangular matrix.
\end{remarque}

The implementation of this group in \Lean is based on the formalization of block triangular matrices, coded in by \ref{oui oui la réf} as follows :
\begin{leancode}
variable {α : Type*} [LT α]
def Matrix.BlockTriangular (M : Matrix n n F) (b : n → α) : Prop :=
 ∀ ⦃i j : n⦄, b j < b i → M i j = 0
\end{leancode}

\begin{commentary}
First, we introduce a type \lean{α : Type*} with an \lean{[LT α]} instance.  What it means is that we endowed the \lean{α} with a binary relation \lean{< : α → α → Prop} with no particular property.
\end{commentary}\todo{might be going to annex} 

With this we define the groups of block triangular matrices (which depends on the block decomposition given by the parameter \lean{b : n → α} :

\begin{leancode}
def BlockTriangularGroup (b : n → α ) : Subgroup (GL n R) where
  carrier :=  {M : GL n R | BlockTriangular M.val b }
  ...
\end{leancode}

\todo{CompleteLinearOrder} 
Finally, we endow the type \lean{n} with a \lean{[CompleteLinearOrder n]} instance whose property are explained in \todo{annex} and we define the group of triangular matrices as : 
\begin{leancode}
variable [CompleteLinearOrder n] 
def  TriangularGroup : Subgroup (GL n F):= BlockTriangularGroup id
\end{leancode}
where \lean{id : n → n} is the identity map. 

Finally, let us define $\pi$ homomorphism that forms the $BN\pi$-triplet over $GL_n(F)$.

If $M \in  \mathfrak{GL}_n\left( F \right)$ is a monomial matrix, let $f : \{1\ldots,n\} \to  \{1,\ldots,n\}$ be the map that to $j \in \{ 1,\ldots,n\}$ associate the index $f(j)$ such that $M_{f(j), j} \neq 0$, then

\begin{lemme}
    \begin{enumerate}
        \item $f \in \mathfrak{S}_n$
        \item the map 
            \begin{align*}
                \pi : N_n\left( F \right) &\longrightarrow \mathfrak{S}_n \\
                M &\longmapsto \pi (M) = f  
            \end{align*} is a group homomorphism.
    \end{enumerate}
\end{lemme}

\begin{proof}
    The first point is immediate by definition of a monomial matrix and the second follows from the calculations performed in the proof \ref{prop:monomial} to show that $N_n\left( F \right)$ is closed by product.
\end{proof}


\todo{foramlisation} 


\begin{theoreme} \label{thm:GL}
    The subgroups $B_n\left( F \right)$ and $N_n\left( F \right)$ alongside the group homomorphism $\pi : N \to \mathfrak{S}_n$ form a $BN\pi$-triplet over $GL_n\left( F \right)$.
\end{theoreme}
\begin{proof}

Before proving that the first axiom of $BN\pi$-Triplet holds let us introduce one last group.
\begin{definition}[Permutation matrices]
    The \emph{permutation matrix} associated to the permutation $f$ is the matrix $P_f = \left( \delta_{i,f(j)} \right)_{i,j \in  \{1,..,n\}}$.
\end{definition}

Immediately we have the following property : 

\begin{propriete} \label{prop:permmat}
    The permutation matrices are monomial and the map $P : f \mapsto P_f$ is group isomorphism on its image.
\end{propriete}

\begin{proof}
    It is immediately clear that the permutation matrices are monomial and that the map $P$ is injective. Then, the multiplicativity of $P$ can be verified through simple computations.
\end{proof}

In \Lean we first define the map $P$ as the function \lean{PermMatrix : Perm n → Matrix n n F}, then we endow it with a monoid homomorphism \lean{_PermMatrix_Hom : Perm n →* Matrix n n F}. This monoid homomorphism is then lifted to a group homomorphism from \lean{Perm n} to the group of units of \lean{Matrix n n F}, that is \lean{GL n F := (Matrix n n F)ˣ} which is called \lean{PermMatrix_Hom : Perm n → GL n F}. Finally, \lean{PermMatrixGroup : Subgroup (GL n F)} the group of permutation matrices is defined as the range of that last homomorphism and by restricting this same morphism to its range we obtain the group homomorphism \lean{PermMatrix_Hom' : Perm n →* PermMatrixGroup}.
\begin{leancode}
/--The permutation matrix associated to a permutation `f`.-/
def PermMatrix (f : Perm n) : Matrix n n F := 
    Matrix.of (fun i j ↦ if i = f j then 1 else 0)

 /-- PermMatrix seen as a monoid homomorphism from `Perm n` to `Matrix n n R`-/
def _PermMatrix_Hom : Perm n →* Matrix n n F where
  toFun := fun f ↦ PermMatrix f
  ...

/-- The group homomorphism version of `_PermMatrix_Hom`-/
def Matrix.PermMatrix_Hom : Perm n →* GL n F :=
  (_PermMatrix_Hom : Perm n →* Matrix n n F).toHomUnits

/-- The Group of permutation matrices.-/
abbrev PermMatrixGroup : Subgroup (GL n F) := PermMatrix_Hom.range

/--The PermMatrix seen as a group homomorphism from `Perm n` to `PermMatrixGroup`-/
def PermMatrix_Hom' : Perm n →* (PermMatrixGroup :Subgroup (GL n F)) :=
  PermMatrix_Hom.rangeRestrict

\end{leancode}



\begin{enumerate}
    \item \label{GL1} Now let us prove that $GL_n\left( F \right)$ is generated by $B_{n}\left( F \right)$ and $N_n\left( F \right)$. To do so, we will use the following result \footnote{For the definition of transvection matrices and some of their properties go to \ref{yes l anneks} and for a proof of this lemma see \cite{oui oui la re}.} : 

\begin{lemme} \label{lem:trans}
    Every matrix in $GL_n\left( F \right)$ can be written as a product of transvection matrices, an invertible diagonal matrix and transvection matrices.
\end{lemme}
This lemma appears in \Lean as :
\begin{leancode}
theorem Matrix.Pivot.exists_list_transvec_mul_mul_list_transvec_eq_diagonal 
  (M : Matrix n n F) : ∃ (L : List (Matrix.TransvectionStruct n F)) 
    (L' : List (Matrix.TransvectionStruct n F)) (D : n → F), 
      (List.map Matrix.TransvectionStruct.toMatrix L).prod * M * 
         (List.map Matrix.TransvectionStruct.toMatrix L').prod = Matrix.diagonal D
\end{leancode}

Diagonal matrices being blatantly triangular, we just need to show that  are in $\left<B,N \right>$. Let $c \in F$ and $i,j$ be two distinct elements of $\{ 1,\ldots,n\}$ and let $T_{i,j}\left( c \right)$ denote the transvection matrix of indexes $\left( i,j \right)$ and scalar $c$ as defined in \ref{l'annexe}. If $i<j$, $T_{i,j}\left( c \right)$ is an upper triangular matrix. Otherwise, if $j>i$ then by remarking that $T_{i,j}(c) = P_{\left( i,j \right)} T_{j,i}\left( c \right) P_{\left( i,j \right)}$, we have the result because as just seen $T_{j,i}\left( c \right) \in B_n\left( F \right)$ and by \ref{prop:permmat}, the transposition matrix $P_{i,j}$ is monomial.

In \Lean, we refer to this result as :
\begin{leancode}
theorem MonomialTriangular_gen_GL : 
    (⊤ : Subgroup (GL n F)) = MonomialGroup ⊔ TriangularGroup
\end{leancode}


\item \label{GL2} For the second point let us show that both the intersection of $B_n(F)$ and $N_n\left( F \right)$ and the kernel of $\pi$ are equal to the group $T_n\left( F \right)$ of invertible diagonal matrices. 

    Firstly, all invertible diagonal matrices are clearly triangular so $T_n\left( F \right) \le  B_n\left( F \right) \cap N_n(F)$. Conversely, if $M \in B_n(F) \cap  N_n(F)$, as an invertible triangular matrix, its diagonal coefficients are nonzero, then as a monomial matrix they are the only nonzero coefficients, so $M \in B_n(F) \cap N_n(F)$.

    Secondly, a matrix $M \in GL_n(F)$ belongs to the kernel of $\pi$ if and only if for all index $i \in  \{ 1,..,n\}$ the only nonzero coefficient on the $i$-th line are the diagonal ones \textit{i.e.} if and only if $M \in T_n\left( F \right)$. Therefore, $T_n\left( F \right) = B_n\left( F \right) \cap N_n(F)$.

    Hence, by transitivity of the equality relation we have $\ker \pi = Bn(F) \cap N_n(F)$. That statement in accessed through :
    \begin{leancode}
theorem ker_toPermHom_eq_Diagonal :
  toPermHom.ker = TriangularGroup.subgroupOf (MonomialGroup :Subgroup (GL n F))
    \end{leancode}
    

\item \label{GL3}We will now show that $\pi : N \to \mathfrak{S}_n$ is surjective. We will do it by showing that $P : f \mapsto P_f $ is a right section of $\pi$. Indeed, for all $f \in \mathfrak{S}_n$ we saw that the only nonzero coefficient of the $i$-th line, for $i=1,...,n$, is $f(i)$. Therefore, $\pi\left( P_f \right) = f$ and $\pi$ is surjective.We formalized this result in \Lean as:
\begin{leancode}
theorem toPermHom_surj :
  Function.Surjective (toPermHom : (MonomialGroup : Subgroup (GL n F)) →* Perm n)
\end{leancode}

\item A simple induction on $n$ shows that $\mathfrak{S}_n$ is generated by the set $S:= \{\left( i,i+1 \right) | 1\le i\le n-1\}$ and transposition being of order $2$, this proves the fourth point. \todo{Lean implemenation}

\item Let $i \in  \{ 1,..,n-1\}$ and $M_i \in N_n(F)$ maps to $\left( i,i+1 \right)$ through $\pi$. By \ref{GL2} and \ref{GL3} there exists $D \in T_n(F)$ such that $M_i = P_{((i,i+1)} D$. Therefore, $M_i B_n(F) M_i \neq B_n(F)$ if and only if $P_{i} B_n(F) P_{i}\neq B_n(F)$, where $P_i$ denotes the permutation matrix $P_{(i,i+1)}$. As seen in \ref{GL1}, the transvection matrix $T_{i+1,i}(1)$ is equal to $P_{i} T_{i,i+1}(1) P_{i} \in P_{i}B_n(F) P_{i}$. However, $T_{i+1, i}(1)$ is not upper triangular and hence $P_{i} B_n(F) P_{i} \neq B_n(F)$.

    This result appears in our code as :
\begin{leancode}
theorem left_right_mul_Triangular_neq_Triangular_of_map_swap {Ma : MonomialGroup}
 (h : Ma ∈ toPermHom⁻¹' SwapSet) :
   ¬ {Ma * (b.val: GL n F) * (Ma.val : GL n F) | b :  TriangularGroup} ⊆
    (TriangularGroup : Subgroup (GL n F)).carrier
\end{leancode}




\item The final point of the proof is the hardest to prove. We introduce $i \in \{1,\ldots,n-1\}$ and $M_i \in N_n(F)$ as above and we fix a monomial matrix $M \in N_n(F)$. 

    Let us show that $M_i B_n(F) M \subset C(M_iM) \cup C(M) $. Thanks to a reasoning similar to the one above, we only have to prove that  $P_{i} B_n(F) M \subset C\left( P_i M \right)\cup C(M)$ or in an equivalent manner $P_i B_n(F) \subset B_n(F) P_i B'_n(F) \cup B_n(F) B'_n(F) $ where $B'_n(F) := M B_n(F)M^{-1}$.

    Let us define as $G_i$ the subgroup of $GL_n(F)$ consisting of the block diagonal matrices of the form 
    $$\begin{pmatrix} 
        I_{i-1} \\
        & M\\
        & & I_{n-(i+1)}
    \end{pmatrix}$$
    for $M \in GL_2\left( F \right)$.

    \todo{implemenation} 
    The group $G_i$ is very clearly isomorphic to $GL_2\left( F \right)$ and $P_i = 
    \left(\begin{smallmatrix}
        I_{i-1} \\ & 0 & 1 \\ & 1 & 0 \\ & & & I_{n-i-1}
    \end{smallmatrix} \right ) \in G_i$.
Additionally, some simple but very annoying to formalize computations show that $G_i B_n(F) \subset B_n(F) G_i$ and hence $P_i B_n(F) \subset B_n(F) G_i$ so we only need to prove that : 
    $$G_i \subset \left(B_n(F) \cap G_i\right) \ P_i \ \left( B'_n(F) \cap  G_i\right) \ \bigcup \ \left(B_n(F) \cap G_i\right) \ \left(B'_n(F) \cap G\right).$$

    Let $\psi$ denote the natural isomorphism from $GL_2(F)$ to $G_i$. In Lean we formalized it as \lean{GL2toG2ij hij : GL (Fin 2) F ≃* (G2ij hij : Subgroup (GL n F)}\todo{probably ti modifiy} To do so we first observe that that $\psi^{-1} \left(B_n(F) \cap G_i \right)$ is the group $B_2\left( F \right)$ of $2 \times 2$ triangular matrices and that $B'_2(F) := \psi^{-1}\left( B'_n(F) \cap G_i \right)$ is either the upper or the lower triangular subgroup of $GL_2\left( F \right)$ depending on whether $\phi\left( M \right) (i) < \phi\left( M \right) (i+1)$ or the opposite.

In the first case we need to show that $$GL_2(F) = B_2(F) \cup B_2(F) s B_2 (F)$$ with $s = \left( \begin{smallmatrix}
    0 & 1 \\
    1 & 0
\end{smallmatrix} \right)$.
However as seen in \todo{complements on double cosets}, $B_2(F) \cup B_2(F) s B_2 (F)$ is a subgroup of $GL_2(F)$ which additionally contains both $B_2(F)$ and $N_2(F)=\{1,s\}$ so as shown in \ref{GL1} it is equal to $GL_2(F)$.

In the second case we have to show that $GL_2 (F) = B_2(F) B_2^{-}(F) \cup B_2(F) s B_2^{-} (F)$ where $B_2^{-}\left( F \right)$ denotes the lower triangular group of $GL_2(F)$. This result is immediate follows from the precedent one by remarking that $B^{-}(F) = s B_2(F) s$.

Hence we have the following statement in Lean :
\begin{leancode}
theorem GLsubset_union_doubleCosets : ∀ (M Ma : MonomialGroup), ∀ s ∈ SwapSet, 
 toPermHom Ma = s ->
  {(Ma.val * b.val * M.val : GL n F) | b : (TriangularGroup : Subgroup (GL n F))} ⊆
      C TriangularGroup (Ma * M).val∪ C TriangularGroup M.val 
\end{leancode}
\end{enumerate}

\begin{implementation}
The different results presented above allow us to build an object of type \lean{BNpiTriplet (GL n F) (Perm n)} as follows :      
\begin{leancode}
/--The `BNMphiQuadruplet`  structure over `GL n F`.-/
noncomputable
def GeneralLinearGroup_BNpiTriplet : BNpiTriplet (GL n F) (Perm n) where
  B := TriangularGroup
  N := MonomialGroup
  S := SwapSet
  pi := toPermHom
  BN_gen_Group := TriangularMonomial_gen_GL
  pi_surj := toPermHom_surj
  ker_pi_eq_B_subgroupOf_N := ker_toPermHom_eq_Diagonal
  self_inverse_of_mem_S := self_inverse_of_mem_SwapSet
  top_eq_S_closure := top_eq_swap_closure
  left_right_mul_B_neq_B_of_map_S := fun _ h => left_right_mul_Triangular_neq_Triangular_of_map_swap h
  subset_union_doubleCosets := GLsubset_union_doubleCosets'
\end{leancode}
\end{implementation}
\end{proof}

\section{Some results on groups with a $BN$-pair}

This section present some of the main results that have been formalized on groups with $BN\pi$-triplet during this internship. However, as it will be discussed in \ref{subsub:Coxeter2} all of the results necessary to prove the simplicity theorem \ref{thm:simple} have been proven due to the need for a more advanced theory of Coxeter groups than the one currently available in Mathlib. Thus, most of the results presented in this part will not be proven.

This section first starts by presenting a way to endow with a $BN\pi$-triplet certain quotients of groups with $BN\pi$-triplet. Then after an introduction to the theory of Coxeter groups, we will the link of such groups with groups with $BN\pi$-triplet. Finally, a few results concerning the subgroups of $G$ that contains $B$ or one of its conjugates will be exposed. 

\subsection{Quotient $BN\pi$-triplet}

    Let $Z$ be a normal subgroup of $G$ contained in $B$. Let us denotes as $\hat{G}$ the group $G /Z$, as $\hat{B}$ the groups $B/{Z}$, as $\hat{N}$ the group $N/(N\cap Z)$ and as $\hat{\pi}$ the lift of $\pi$ through the natural homomorphism $N \to (N \cap Z)$. Then we have :

\begin{definition}[Quotient $BN\pi$-triplet] \label{def:quotBN}
$\left( \hat{B},\hat{N},\hat{\pi} \right)$ forms a $BN\pi$-triplet over $\hat{G}$ called the quotient $BN\pi$-triplet of $\left( B,N, \pi \right)$ by $Z$.
\end{definition}

\todo{see if proof} 
If proving this theorem does not require much efforts \footnote{And we incite the reader to do so}, formalizing it is a bit more arduous. That is why we introduced the equivalent structure of image $BN\pi$-triplet :

\begin{definition}[Image $BN\pi$-triplet]
Let $G'$ be a group, $p$ a surjective homomorphism from $G$ to $G'$ and $\pi': p(N) \to W$ a group homomorphism. If $\ker p \le B$ and $\pi' \circ p = \pi$ then $\left( p(B), p(N), pi' \right)$  forms a $BN\pi$-triplet over $G'$ called the image $BN\pi$-triplet of $(B,N, \pi)$ by $p$.
\end{definition}

It appears clearly from the definitions above that if $Z \le B$ is normal in $G$ then the quotient $BN\pi$-triplet of $\left( B,N, \pi \right)$ if nothing more than the image $BN\pi$-triplet of $\left( B,N, \pi \right)$ by the natural homomorphism $G \to G / Z$. Thus, we can use image $BN\pi$-triplet to formalize quotient $BN\pi$-triplet and that is how we proceeded :

\begin{leancode}
variable (G' : Type*) [Group G']

def ImageBNpiTriplet {p : G →* G'} (p_surj: Surjective p) (ker_p_le_B : p.ker ≤ TS.B)
    {p' : TS.N →* TS.N.map p} (p'_rest_p : ∀ n, p n.val = (p' n).val) {pi': TS.N.map p →* W}
      (p_comm_pi' : TS.pi = pi'.comp p') : BNpiTriplet G' W where
  B := TS.B.map p
  N := TS.N.map p
  pi := pi'
  S := TS.S
  ...

noncomputable
def QuotientBNpiTriplet (Z : Subgroup G) [Normal Z] (ZleB : Z ≤ TS.B): BNpiTriplet (G ⧸ Z) W :=
    ImageBNpiTriplet TS (QuotientGroup.mk'_surjective Z) ...
\end{leancode}

\begin{commentary}
    \begin{itemize}
        \item 
    The definition of \lean{ImageBNpiTriplet} may seem verbose and ask for more argument than needed. Itt is true but it makes the formalization easier. 

\item The term \lean{QuotientGroup.mk'_surjective Z : Function.Surjective} \lean{⇑(QuotientGroup.mk' Z)} used in the definition of \lean{QuotientBNpiTriplet} is a proof that the natural homomorphism from $G$ to $G / Z$, \lean{QuotientGroup.mk' Z: G → G ⧸ Z} is surjective.
    \end{itemize}
\end{commentary}


\begin{ex}
    In the case of $G = GL_n(F)$, the center $Z$ of $GL_n(F)$ is normal in $GL_n(F)$ and is equal the group of nonzero scalar matrices and as such $Z \le B_n(F)$. Therefore, the quotient $BN\pi$-triplet of $\left( B_n(F),N_n(F), \pi \right)$ by $Z$ forms a $BN\pi$-triplet over $PGL_n\left( F \right) := GL_n(F)/Z$.
One can find this fact formalized in \lean{GLn.lean}\footnote{The definition of \lean{PGL} is not present in Mathlib and was coded for this project, you can find it defined in \ref{oui l'annexe et tout}} as :
\begin{leancode}
nnoncomputable
def ProjectiveGeneralLinearGroup_BNpiTriplet : BNpiTriplet (PGL n F) (Perm n) :=
  QuotientBNpiTriplet (GeneralLinearGroup_BNpiTriplet n F) (Subgroup.center (GL n F))  GLncenter_le_Triangular
\end{leancode}  
\end{ex}


\subsection{Relations with Coxeter groups}

    Coxeter groups are an important family of abstract groups which have been intensively studied since their introduction by H. S. M. Coxeter in 1934 in \cite{coxeter_discrete_1934}. 
   Lots of important results have been discovered concerning these groups (see §1 of \cite{bourbaki_groupes_2007}, for instance), results which can be used to get more insights on the structure of groups with $BN\pi$-triplet.
   Indeed, as we will see in \ref{subsub:Coxeter2} if the group $G$ has $BN\pi$-triplet with $\pi : G \to W$ then $W$ is a Coxeter group and this additional property of $W$ is especially useful to highlight even more the link between groups with $BN\pi$-triplet and double cosets. However, this link will not be really put forward in this report for reasons explained in \ref{subsub:Coxeter2} but can be found in \cite{bourbaki_groupes_2007}.
    This subsection first presents the definition and some basic properties as well as the \Lean implementation of Coxeter groups, and then the link with groups with $BN\pi$-triplet is discussed.

\subsubsection{Introduction to Coxeter theory}
We first recall \ref{sub:presentation} \todo{le pres} 

Let $W$ be a group and $S$ a subset of elements of order $2$ of $W$.
For all two elements $s, s' \in  S$, we define $m(s,s') \in  \mathbb{N}$ to be the order of the product $ss'$ if it is finite and $0$ otherwise.

\begin{definition}[Coxeter system]
    We say that the couple $(W,S)$ is a \emph{Coxeter system} if the generating set $S$ alongside with the relations $(ss')^{m\left( s,s' \right)} = 1$ for all $s,s' \in S$, forms a presentation of $W$. 
\end{definition}

When $\left( W,S \right)$ is a Coxeter system, the elements of $S$ are called simple (reflections) and by an abuse of language \todo{not sure}, $W$ is called a \emph{Coxeter group}.

\begin{ex}\

    \begin{enumerate}
        \item  For all natural number $n$, $\mathfrak{S}_n$, the symmetric group over $\{1,\ldots,n\}$ with the set of transposition $(i,i+1)$ for $1\le i \le n $ forms a Coxeter system.
        \item Let $m$ be a natural number, let $s$ denote the symmetry of the complex plane over the real line and $r$ the rotation of angle $\frac{2i \pi}{m}$. The dihedral group $D_{2m} := \left<r,s\right>$ alongside with $S= \{r,s\}$ is a Coxeter System. 
    \end{enumerate}
\end{ex}

The Lean implementation \lean{CoxeterSystem} of a Coxeter system does not make a direct use of the above definition but is in fact based upon the following concept of a Coxeter matrix :

\begin{definition}[Coxeter matrix]
    Let $A$ be a set. A square symmetric matrix $M = \left( m_{a,a'}\right)_{a,a' \in A}$ with coefficient in $\mathbb{N}$ is a \emph{Coxeter matrix} of type $A$ if it satisfies 
\begin{itemize}
    \item $\forall  a \in A, m_{a,a} = 1$
    \item $\forall a,a' \in  I, a \neq  a' \Rightarrow m_{a,a'} \neq 1$
\end{itemize}
 
    If $\left( W,S \right)$ is a Coxeter system, then the matrix $M = \left( m\left( s,s' \right) \right)_{s,s' \in  S}$ is a Coxeter matrix of type $S$ called the Matrix of $\left( W,S \right)$.
    %and $(s_a)_{a \in A}$ denote the family of all the elements of $S$ indexed by $A$. We say call the matrix $M = \left( m\left( s_a, s_b \right) \right)_{a,b in A}$ the \emph{Coxeter matrix} of type $A$.
\end{definition}

\begin{proof}
    Suppose that $\left( W,S \right)$ is a Coxeter system. It is immediate that $m\left( s,s \right) = 1$, and $m(s,s') \ge  2$ for all $s,s' in S$. Additionally, $s.s' = (s'.s)^{-1}$ and therefore $\left( m\left( s,s' \right) \right)_{s,s' \in  S}$ is symmetric.
\end{proof}

The Lean implementation of Coxeter matrices is pretty straightforward and does not need any commentary (the \lean{by decide}s can be ignored):
\begin{leancode}
structure CoxeterMatrix (A : Type*) where
  /-- The underlying matrix of the Coxeter matrix. -/
  M : Matrix A A ℕ
  isSymm : M.IsSymm := by decide
  diagonal i : M i i = 1 := by decide
  off_diagonal i i' : i ≠ i' → M i i' ≠ 1 := by decide
\end{leancode}

\begin{definition}[Group of a Coxeter matrix]
    The \emph{group  $G(M)$ of a Coxeter matrix} $M$ of type $A$ is the presented group with generator $A$ and relations $(a.a')^{m\left( a,a' \right)} = 1$ for all $a,a' \in A$. 
\end{definition}

In Lean, if \lean{M} has type \lean{CoxeterMatrix A} for a certain type \lean{A} its group is denoted as \lean{M.Group}. Additionally, the generator of \lean{M.Group} can be accessed through the function \lean{M.simple : A → M.Group} mapping each element of type \lean{\B} to its image in the group of \lean{M}. This group also verifies the following properties :

\begin{propriete}

\begin{enumerate}
    \item If $M$ is a Coxeter matrix of type $A$, for $A$ a set, then $\left( G\left( M \right),A \right)$ is a Coxeter system.
    \item $\left( W,S \right)$ is a Coxeter system if and only if there exists a set $A$ and a Coxeter matrix $M$ of type $A$, and an isomorphism $f : G\left( M \right) \to W$ sending bijectively $A$ to $S$. 
    %\item Let $\left( W,S \right)$ and $\left( W', S' \right)$ be two Coxeter systems such that there exists a Coxeter matrix $M$ of type $A$, and groups isomorphisms $f : G(M) \to  W$ and $f' : G\left( M \right) \to W'$ sending $A$ to $S$ ad $S'$ respectively. Then there exists a group isomorphism $ \phi : W \to W'$ sending 
\end{enumerate}
        %\todo{bien faire}
\end{propriete}
   
\begin{proof}

The proof of 1. follows from the definition of $G\left( M \right)$.
If $\left( W,S \right)$ is a Coxeter system then its Coxeter matrix $M$ fits and we have $ W \simeq G(M)$ by definition of a Coxeter system. The converse implication is immediate from the definition of a Coxeter matrix.

\end{proof}
Let $M$ be a matrix of type $A$ and an isomorphism $f : G(M) \MapsTo W$ sending $A$ to $S$. Then the latter proposition tells us that the couple $\left( M,f \right)$ characterizes the Coxeter system structure on $\left( W,S \right)$. This fact serves as the definition of a Coxeter system in Lean. 
Indeed, given a type \lean{A}, an element \lean{M} of type \lean{CoxeterMatrix A} and a type \lean{W} endowed with a group structure, an element of type \lean{CoxeterSystem M W} consists in the data of a group isomorphism between \lean{W} and \lean{M.Group}.

\begin{leancode}
structure CoxeterSystem {A : Type*} (M : CoxeterMatrix A) (W : Type*) 
    [Group W] where
  /-- The isomorphism between `W` and the Coxeter group associated to `M`. -/
  mulEquiv : W ≃* M.Group
\end{leancode}

\todo{Maybe length}
These definitions is all the Coxeter theory we need.

\subsubsection{BN-pairs and Coxeter theory}
\label{subsub:Coxeter2}
\begin{theoreme} \label{thm:Coxeter}
    $\left( W,S \right)$ is a Coxeter system.
\end{theoreme}
 The proof of the above theorem can be found in \ref{bourbaki_groupes_2007} §2 n°4 and is a consequence of the decomposition of $G$ in double cosets (see theorem \ref{thm:DCD}). However, like many of the results that will be described from now on, it makes a heavy use of parts of the theory of Coxeter groups that are not yet in implemented in \Lean. 
    
 As proving all the results needed might necessitate a whole other internship by itself, it was decided to leave the task of proving them to other and focus the goal of proving the simplicity theorem (theorem \ref{thm:simple}). The \Lean code is therefore filled with holes. However, every proof that did not make a direct use of the Coxeter group theory has been formalized, and the full list of the necessary results and where they are needed in the code is available in \todo{ouiiii}. 

 Additionally, proving the result mathematically in this report would not be of great interest, as it would either necessitate a large amount on the Coxeter group theory to be exposed -which was not the object of this internship- or that the proofs given would be filled with references to other works. That is why what follows will mostly consists in definitions and statements of theorems with the notable exception of theorem \ref{thm:simple}.

The first property that necessitate advanced Coxeter group theory to be proven is the very fact that $\left( W,S \right)$ is a Coxeter system. We formalized it as follows with the use of \lean{sorry} \footnote{The reader unfamiliar with the implemenation of Coxeter groups in \Lean should not pay to much attention to the following lines and only keep in mind that used \lean{sorry} to provide a Coxeter group structure over \lean{W}.}. \todo{explain sorry} 

\begin{leancode}
def BNpiTriplet.coxeterMatrix  (TS : BNpiTriplet G W) : CoxeterMatrix TS.S where
  M := Matrix.of fun s s' => orderOf (s*s' : W)
  ...

def  BNpiTriplet.cs : CoxeterSystem TS.coxeterMatrix W where
  mulEquiv :=sorry

abbrev BNpiTriplet.length (TS : BNpiTriplet G W) := TS.cs.length

abbrev BNpiTriplet.simple (TS : BNpiTriplet G W) := TS.cs.simple

lemma simple_id_mem_S : TS.simple = fun s => s.val := sorry
\end{leancode}

Using the above theorem\footnote{The proof only really makes use of the notion of \emph{length} of an element, which is defined for every group generated by elements of order $2$, but is only implemented in \Lean in the Coxeter groups. However, introducing the whole theory of length for only one proof would require  important efforts for both the reader and he author for very limited interest. For more information around this subject we once again send to \cite{bourbaki_groupes_2007}.} we have the following: 

\begin{lemme}
    The map sending an element $w \in W$ to its double coset $C'\left( x \right)$ is bijective.
\end{lemme}

This appears in \Lean as \lean{Weyl_doubleCosets_equiv : W ≃ Set.range TS.C'} and makes use of the lemma \lean{C'_inj' : Function.Injective TS.C'} which might of interest for some readers planning to build over the code presented here.

\subsection{Subgroups of $G$}

This subsection present a few results around subgroups of $G$ containing $B$ or conjugates of $B$.

Let $X$ be a subset of $S$. We denote as $W_X$ the group generated by $X$. In \Lean  we represent $X$ by an object \lean{X} of type \lean{Set TS.S} and $W_X$ is the term \lean{Subgroup.closure X : Subgroup W}. We have :
\begin{theoreme} 
    The set $G_X := \bigcup_{x \in W_x} C'\left( x \right)$ is a subgroup of $W$ that contains $B$.
\end{theoreme}

In \Lean we the groups $G_X$ are formalized through :

\begin{leancode}
def DoubleCoset_of_Set ( X : Set TS.S) : Subgroup G where
  carrier := ⋃ x ∈ closure (X : Set W), TS.C' x
  ...
\end{leancode}

The importance of these groups appears in the following theorem :

\begin{theoreme} \label{thm:GX}
     
    The map \vspace{-0.2cm}
\begin{align*}
\mathcal{P}\left( S \right) &\longrightarrow \{\text{Parabolic subgroups of $G$}\} \\
X &\longmapsto G_X 
.\end{align*}
    is bijective. 
\end{theoreme}

The above bijection can be accessed in lean \textit{via} \lean{DoubleCoset_of_Set_bij : Set TS.S ≃} \lean{{H :Subgroup G // TS.B ≤ H}}. This is a great example of the deep connection between the structure of the group $G$ and the double cosets $C'$ over $B$.

Now we introduce the definition of parabolic subgroups as below :

\begin{definition}
    A subgroup $P$ of $G$ is said \emph{parabolic} if it contains a conjugate of $B$.
\end{definition}

\begin{implementation} \
\begin{leancode}
def Subgroup.Parabolic (P : Subgroup G) : Prop := ∃g, ConjugatedSubgroup TS.B g ≤ P
\end{leancode}
\end{implementation} \todo{ConjugatedSubgroup} 

Before, stating the only result on parabolic groups of this report we will recall the definition of the normalizer of a groups.

\begin{definition}
    The normalizer of a subgroup $H$ of $G$ is the largest subgroup of $G$ in which $H$ is normal.
\end{definition}

The normalizer of an object \lean{H : Subtype G} is denoted \lean{H.normalizer : Subgroup G} in \Lean. We can now state the following theorem :
\begin{theoreme}\label{thm:parabolic}
    A parabolic subgroup $P$ is its own normalizer.
\end{theoreme}

This theorem as been formalized as \lean{eq_normalizer_of_parabolic {P : Subgroup G} (h : P.Parabolic TS) : P = P.normalizer}. This theorem as well the following lemma will be used to prove \ref{thm:simple}. This last moreover, more of a technical lemma to prove \ref{thm:simple} than an actual result.

\begin{lemme} \ref{lem:2}
Let $H \triangleleft G$. There exists $X \subset S$ such that $BH = G_$ and every element of $X$ commute with every element of $S \setminus X$. 
\end{lemme}

\section{The simplicity theorem}%
\label{sec:The simplicity theorem}

In this section we state and prove a theorem that can be used to show that groups with $BN\pi$-triplet are simple when applicable. Then we apply this theorem to case of the projective special linear group over a field.

\subsection{The theorem}
Before stating the theorem, we will recall two definitions from group theory.

\begin{definition}
    A group is \emp{simple} if it has exactly two normal subgroups : the trivial subgroup and itself.
\end{definition}

In \Lean a group \lean{Γ} is simple if it is endowed with an \lean{IsSimpleGroup Γ} instance.

\begin{definition}
    A group $\Gamma$ is said \emph{perfect} if equal to its derived subgroup.
\end{definition}

In \Lean the derived subgroup of a group \lean{Γ} is denoted \lean{⁅⊤, ⊤⁆ : Subgroup Γ}. 
    

    Now, let $U$ be a normal subgroup of $B$. We define $Z$ to as the group $Z := \bigcap_{g \in G} g B g^{-1}$, and we denote as  $G_1$ the subgroup $G_1 := \bigsqcup_{g \in G} g U g^{-1}$ of $G$.

\begin{theoreme} \label{thm:simple}
If the following conditions are verified :
\begin{enumerate}
    \item \label{simple1} $B = UT$
    \item \label{simple2} The only perfect quotient group of $U$ is the trivial  group, or in other words for all strict normal subgroup $V$ of $U$,  $U / V \neq  [ U / V, U/V]$.
    \item \label{simple3}$G_1$ is perfect
    \item \label{simple4} the Coxeter system $\left( W,S \right)$ is irreducible \textit{i.e.} there is no subset $X$ of $S$ such that every element of $X$ commutes with every element of $S-X$.
\end{enumerate} 
    then $G_1 / \left( Z \cap G_1 \right)$ is either trivial or simple noncommutative.
\end{theoreme}

\begin{corollary} \label{cor:2}
    If $U \cap Z = \{1\}$ then $Z \cap G_1$ is the center of $G_1$.
\end{corollary}

\begin{proof}
    As both $Z$ and $U$ are normal in $B$, every element of $Z$ commutes with every element of $U$, thus with every element of $G_1$. Then, the result follows from the above corollary.
\end{proof}

\begin{proof}[Proof of the theorem]

Let us show that every subgroup $H$ of $G$ normalizing $G_1$ is either contained in $Z$ or contains $G_1$.

    First, let us show that $G_1T$ is equal to $G$. To do so we first need to observe that $G_1T$ is subgroup of $G$ that contains $B$ \tododeux{talk bout prodsubgoup} so by \ref{thm:parabolic} it is its own normalizer. Therefore, as $N$ normalizes $G_1$ and $T$, and so $G_1T$, we have $N \le G_{1}T$. Thus, as $B$ and $N$ generates $G$ we have $G = G_1T$.

    \begin{lemme} \label{lem:subBN}
        Let us set $G' := G_1 H$, $B' := B \cap G'$, $N' := N \cap G'$ and $\pi' := \pi_{|N'}$. 
        Then $\left( B', N', \pi' \right)$ forms a $BN\pi$-triplet over $G'$.
    \end{lemme}
    \begin{proof}
        First and foremost, remark that $G'T = G$ because $G_1 \le G'$ and therefore, $N'T = N$.
        \begin{enumerate}
            \item The relations $B=UT=TU$ allows to rewrite theorem \ref{thm:DCD} as $G = UNU$. Then $U$ being a subgroup $G'$, we have $G' = UN'U$ and therefore $G' = \left<B'_n(F),N' \right>$ because $U \le B'$.
            \item The kernel of $\pi' = \pi_{|N'}$ is equal to $\ker pi \cap N' = B \cap N \cap N' = B' \cap N' $.
            \item The surjectivity of $\pi'$ is direct consequence of the surjectivity of $\pi$ and the relations $N=N'T$ and $\ker \pi = T$.
            \item Immediate.
            \item \todo{finish it} 
        \end{enumerate}
    \end{proof}

   $H$ is normal in $G_1 H$\ thus, there exists $X \subset \tilde{S}$ such that $B'H = B' W_X B'$ and every element of $X$ commute with every element of $S-X$ (see \ref{thm:parabolic}). However, the Coxeter system $\left( W,S \right)$ is irreducible so $X = \emptyset$ or $X = S$.

     \underline{First case : $X = \emptyset$} \textit{i.e.} $B' H = B'$ so $H \le B' \le B$. Additionally, for all $g \in G$ we have $g_1 \in G_1$ and $t \in T$ such that $g = g_1 t$, so $H$ being normal in $G_1$, $H \subset g_1 B g_1^{-1}$ and thus $H \subset g B g^{-1}$ as $T \le B$. Therefore, $ H \subset Z$.

     In particular, $G_1$ normalizes itself so $G_1 / \left( G_1 \cap Z \right)$ is trivial.

    \underline {Second case $X = S$ :} \textit{i.e.} $B'H = G'$ and so $G = G'T= B'HT = HB'T = HB.$

       As $U \triangleleft B$ all conjugates of $U$ are of the form $h U h^{-1}$ with $h \in  H$ which means they are all subgroups of $UH$. Thus $G_1 \subset UH$ and 
       $$U / \left( U \cap  H \right) \simeq UH / H = G_1H / H \simeq G_1 / \left( G_1 \cap H \right).$$

The group $G_1$ being perfect, its quotient $G_1 / \left( G_1 \cap H \right)$ also is. Thus, $U / (U \cap H)$ also is perfect and as such, it is by hypothesis the trivial group. Therefore, $G_1 = G_1 \cap H$ \textit{i.e.} $ G_1 \le H$.

Thus $G_1 / \left( G_1 \cap Z \right)$ is simple and as $G_1$ is perfect $G_1 / \left( G_1 \cap Z \right)$ also is and therefore cannot be commutative.
\end{proof}


\begin{remark}
    The $BN\pi$-triplet defined in the lemma \ref{lem:subBN} has been formalized in \Lean as :

\begin{leancode}
variable {U : Subgroup G} (hU : U ≤ TS.B) (hU' : (U.subgroupOf TS.B).Normal)
variable (hUT : ⊤ = mul_Subgroup' hU' (TS.T.subgroupOf TS.B))
variable {H : Subgroup G} (hH : ConjSubgroup U ≤ H.normalizer)

def SubBNpiTriplet : BNpiTriplet (Subgroup_mul  hH) W where
  B := TS.B.subgroupOf (Subgroup_mul hH)
  N := TS.N.subgroupOf (Subgroup_mul hH)
  pi := TS.pi.comp (N'toN TS)
  S := TS.S
  ... 
\end{leancode}
\end{remark}

\subsection{Application : the projective special linear group}

We denote as $SL_n(F)$ the \emph{special linear group} over $F$ \text{i.e.} the kernel of the group homomorphism $\det : GL_n(F) \to R^*$ and as $PSL_n(F)$ the quotient of $SL_n(F)$ by its center, which is named the \emph{projective special linear group}.
These groups are (surprisingly) denoted \lean{SL n F} and \lean{PSL n F} in \Lean. We can apply the theorem \ref{thm:simple} alongside with its corollary \ref{cor:2} to show : 

\begin{theoreme}
    If $n \ge 3$ or $n = 2$ and $|F| \ge 4$ then the group $PSL_n\left( F \right)$ is simple.
\end{theoreme}

\begin{proof}
    Let $U$ denotes the strictly upper triangular group \textit{i.e.} the subgroup of $GL_n(F)$ made of the triangular matrices whose every diagonal entry are $1$. It is a normal subgroup of the triangular matrices. 
    We set $Z := \bigcap_{g \in G} g B g^{-1}$ and $G_1 := \bigsqcup_{g \in G} g U g^{-1}$. 
    First, let us show that $G_1 = SL_n\left( F \right)$. Every element of $G_1$ is blatantly of determinant $1$ so now let us show that $SL_n\left( F \right) \le G_1$ by using the following lemma :
    \begin{lemme}
        $SL_n\left( F \right)$ is generated by the transvection matrices.
    \end{lemme}

    \begin{proof}
        By the lemma \ref{lem:trans}, we only need to prove that diagonal matrices of determinant $1$ can be written as products of tranvection matrices. This is easily proven action operations over the lines and colums (see \todo{annex} for a precise proof).
    \end{proof}
    The transvection matrices being either strictly upper triangular matrices or conjugates of strictly upper triangular matrices by transposition matrices as seen in the point 1 of the proof of \ref{thm:GL}, by the above lemma, $G_1 = Sl_n(F)$.
    Now let us prove that the groups defined above verify the hypothesis of \ref{thm:simple}.

    \begin{enumerate}
        \item A simple calculation shows that the diagonal of a product of triangular matrices is the product of their diagonal. Hence, for all triangular matrix $T$, if we denote as $D$ the diagonal the matrix of its diagonal coefficient, which is invertible so in $T_n\left( F \right)$ then the matrix $T' := TD^{-1}$ is strictly upper triangular and therefore $T = T' D \in UT$.
        \item \todo{yesy yes} 
        \item Let us show that $G_1 = SL_n\left( F \right)$ is perfect under the conditions of the theorem by proving that transvection matrices can be written as commutators and using the lemma \ref{lem:trans}.

            Let $i,j$ be distinct elements of $n$ and $c$ be an element of $F$.

            If $n\ge 3$ then we can find an index $k \in n$ distinct from $i$ and $j$ and $T_{i,j}\left( c \right)= [T_{i,k}(c), T_{k,j}(1)]$.

            Otherwise, if $n=2$ then, for all $x, y \in F$
    $$\left[ \begin{pmatrix} x & 0 \\ 0 & x \end{pmatrix}, \begin{pmatrix} 1 & y \\ 0 &1 \end{pmatrix} \right] = \begin{pmatrix} 1 & (x^2-1) y \\ 0 & 1 \end{pmatrix}.$$
    The equation $c = \left( x^2 -1  \right) y$ admits a solution if and only if there exists $x\in F$ that is not a root of the polynomial $X^2-1$ \textit{i.e.} if and only if $|F| \ge 4$.

        \item Let $S_n := \{(i,i+1) | 1\le i\le n-1\}$ and let us show that $\left( \mathfrak{S}_n,S_n \right)$ is irreducible by induction over $n$.
            The cases $n=0,1$ are trivial, so suppose $n\ge21$ and $\left( \mathfrak{S}_{n-1}, S_{n-1} \right)$ irreducible.

            Let $X$ be a subset of $S_n$ such that every element of $X$ commutes with every element of $S_n -X$. Set $X' := X \cap S_{n-1}$, it is a subset of $S_{n-1}$ that commutes with every element of its complement in $S_{n-1}$, thus by hypothesis it is either $S_{n-1}$ or $\emptyset$. If $X' = S_{n-1}$ then $\left( n-1,n \right)$ does not commute with $(n-2,n-1) \in X'$ so $\left( n-1n \right)\in X$ and $X = S_n$. Otherwise, if $X' = \emptyset$ then as $\left( n-2,n-1 \right)$ belongs to $S_n -X$ so does $\left( n-1,n \right)$ and hence $X=\emptyset$.
    \end{enumerate}

    Therefore, by corollary \ref{cor:1} the group $G_1 / (Z \cap G_1) = SL_n(F) / \left( Z \cap SL_n\left( F \right) \right)$ is simple or trivial.
    Now let us verify that $Z$ is the center of $SL_n\left( F \right)$, by using corollary \ref{cor:2}. We see by conjugating by permutation matrices that very matrix in $Z$ is diagonal. The only strictly upper triangular matrix that is diagonal is the identity matrix. Hence, $Z \cap U = \{I_n\}$ and $Z$ is the center of $SL_n\left( F \right)$ . Therefore, $PSL_n\left( F \right)$ is simple because it is not trivial : for example the image of $\left( \begin{smallmatrix}
            0 & 1 \\ 1 & 0\\
    \end{smallmatrix}
     \right) \in SL_n\left( F \right)$ in $PSL_n(F)$ is nontrivial.
\end{proof} \todo{implementation} 



Finally, we end this report by proving that the groups $SL_n(F)$ and $PSL_n(F)$ are groups with $BN\pi$-triplet.

\begin{proposition}
    $SL_n\left( F \right)$ and $PSL_n\left( F \right)$ are endowed with $BN\pi$-triplet. 
\end{proposition}
\begin{proof}
    First, the lemma \ref{lem:subBN} applied in the cases of $H = \{1\}$.tells us that $\left( B_n\left( F \right) \cap SL_n(F), \tilde{N}_n(F), \pi \right)$ is $BN\pi$-triplet over $SL_n(F)$.

    Then, one can verify that the center $Z$ of $SL_n\left( F \right)$ is the group of scalar matrices of determinant $1$, thus is a subgroup of $B_n(F) \cap SL_n\left( F \right)$. Therefore, we can endow $PSL_n(F)$ with the quotient $BN\pi$-triplet of $\left( B_n(F) \cap SL_n(F), N_n(F), \pi \right)$ by $Z$ (see \ref{def:quotBN} for teh definition of quotient $BN\pi$-triplet).
\end{proof}
